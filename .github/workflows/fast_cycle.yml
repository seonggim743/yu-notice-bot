name: YU Crawler Bot (Fast Cycle)

on:
  schedule:
    - cron: '*/30 * * * *' # Every 30 minutes
  workflow_dispatch:

permissions:
  packages: read

jobs:
  scrape:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        site: [yu_news, cse_notice, bachelor_guide, dormitory_notice]

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run Scraper Container
        run: |
          docker run --rm \
          -e SUPABASE_URL=${{ secrets.SUPABASE_URL }} \
          -e SUPABASE_KEY=${{ secrets.SUPABASE_KEY }} \
          -e GEMINI_API_KEY=${{ secrets.GEMINI_API_KEY }} \
          -e DISCORD_BOT_TOKEN=${{ secrets.DISCORD_BOT_TOKEN }} \
          -e TELEGRAM_BOT_TOKEN=${{ secrets.TELEGRAM_BOT_TOKEN }} \
          -e TELEGRAM_CHAT_ID=${{ secrets.TELEGRAM_CHAT_ID }} \
          ghcr.io/${{ github.repository_owner }}/yu-notice-bot-v2:latest \
          python main.py --target ${{ matrix.site }}
